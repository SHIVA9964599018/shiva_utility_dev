<!DOCTYPE html>
<html>
<head>
  <title>Shiva Utility Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50">
  <link rel="icon" href="icons/icon-192.png" type="image/png">
</head>
<body>
  <div id="loading-overlay">
    <div class="loading-box">
      <p>Loading utility data, please wait...</p>
    </div>
  </div>

  <nav>
    <a href="#" data-sub="utility-add-dish" onclick="showUtilitySubSection('utility-add-dish')">Add Dish</a>
    <a href="#" onclick="promptCalorieLogin()">Daily Calorie</a>
    <a href="#" data-sub="utility-food-facts" onclick="showUtilitySubSection('utility-food-facts');loadFoodFacts();">All Food Facts</a>
  </nav>

  <p style="font-weight: bold; font-size: 1.1em; margin-top: 20px; padding-left: 20px;">
    ðŸ“² Install this app for a better experience!
  </p>
  <button id="installApp" style="display: none;">ðŸ“² Install App</button>

  <!-- Welcome Message -->
  <div class="welcome-message" id="welcome-message" style="display: none;"></div>

  <!-- Vision Message -->
  <div class="vision-message">
    I am building this website with love for my family and friends to become more aware of their eating habits and the calorie values of what they eat â€” to help them lead a healthier, more informed life.
  </div>

  <section id="utilities" style="padding:20px;">
    <div id="utility-add-dish" style="display:none;">
      <h3>Add Dish Nutrition Info</h3>
      <form id="nutrition-form" class="nutrition-form">
        <label>Dish Name: <input type="text" id="dish_name" required></label>
        <label>Calories (per 100gm): <input type="number" id="calorie" step="any" required></label>
        <label>Protein (per 100gm): <input type="number" id="protein" step="any" required></label>
        <label>Carbs (per 100gm): <input type="number" id="carbs" step="any" required></label>
        <label>Fibre (per 100gm): <input type="number" id="fibre" step="any" required></label>
        <label>Fats (per 100gm): <input type="number" id="fats" step="any" required></label>
        <button type="submit">Save Dish</button>
      </form>
      <p id="nutrition-message" style="margin-top: 20px;"></p>
    </div>

    <div id="utility-daily-calorie" style="display:none;">
      <div>
        <h3>Daily Calorie Calculator</h3>

        <details open>
          <summary><strong>Breakfast</strong></summary>
          <button onclick="addDishRow('breakfast')">+ Add</button>
          <div id="breakfast-container"></div>
        </details>

        <details>
          <summary><strong>Lunch</strong></summary>
          <button onclick="addDishRow('lunch')">+ Add</button>
          <div id="lunch-container"></div>
        </details>

        <details>
          <summary><strong>Dinner</strong></summary>
          <button onclick="addDishRow('dinner')">+ Add</button>
          <div id="dinner-container"></div>
        </details>

        <button id="calculate-btn">Calculate</button>
        <div id="calorie-result"></div>

        <div id="summary-container" style="display: none;">
          <h3>Saved Dish Summary (From Supabase)</h3>
          <table border="1" cellpadding="6" cellspacing="0">
            <thead>
              <tr><th>Dish Name</th><th>Qty (g)</th><th>Calories</th><th>Protein</th><th>Carbs</th><th>Fibre</th><th>Fats</th></tr>
            </thead>
            <tbody id="dish-summary-body"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="utility-food-facts" style="display:none;">
      <h3>All Food Facts</h3>
      <div id="food-facts-table-container">
         <table id="food-facts-table" class="sortable" border="1" cellspacing="0" cellpadding="6">
          <thead><tr><th>Dish Name</th><th>Cal/100g</th><th>Protein</th><th>Carbs</th><th>Fibre</th><th>Fats</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <div id="loginModal" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%); background:#fff; padding:20px; border:1px solid #ccc; box-shadow:0 2px 10px rg